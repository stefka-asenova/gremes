---
title: "Estimation - Note 5"
author: "Stefka Asenova"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Estimation - Note 5}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: mypr1_rev1.bib
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(gremes)

```

As we do not have a real dataset according to a given block graph we generate observations.

Create the graph
```{r}
rm(list=ls())
g<- graph(c(1,3,1,2,2,3,
            3,4,4,5,5,3,
            3,7,3,6,6,7), directed=FALSE)
g<- set.vertex.attribute(g, "name", V(g), c("a", "b", "c", "d", "e", "f", "g"))
plot(g)

```

Create the edge weights to beassigned to the edges of the graph.
```{r}
# all deltas are squares already
C1<- c(0.2, 0.8, 0.6) # d_13^2, d_12^2, d_23^2
C2<- c(0.3, 0.5, 0.1) #d_34^2, d_45^2, d_35^2
C3<- c(0.4, 0.05, 0.25) #d_37^2, d_36^2, d_67^2

```

Attach the edge weights to the edges 
```{r}
hrmbgobj<- HRMBG(g)
hrmbgobj<- setParams(hrmbgobj, c(C1, C2, C3))
hrmbgobj

```

Create the matrix Lambda, whose entry $\lambda_{ij}$ is the sum of the edge weights on the shortest path between 
node $i$ and node $j$.
```{r}
hrmlam<- HRLambda(hrmbgobj)
hrmlam

```

Generate 1000 observations from Huesler-Reiss distribution with parameter matrix $\Lambda$ and some independent
random noise.
```{r}
X<- rHRM(hrmbgobj, hrmlam, 1000, noise = TRUE)

```

Create the subsets for local estimation.
```{r}
rdsobj<- RootDepSet()
rdsobj<- setRootDepSet(rdsobj,subset=list(c("a", "b", "d", "e", "f", "g"),
                                          c("a", "b", "d", "e", "f", "g"),
                                          c("a", "b", "d", "e", "f", "g"),
                                          c("a", "b", "d", "e", "f", "g"),
                                          c("a", "b", "d", "e", "f", "g"),
                                          c("a", "b", "d", "e", "f", "g")), 
                       c("a", "b", "d", "e", "f", "g"))
```

Estimate the model treating the third variable as latent.
```{r}
X<- X[,-3]
hrmbgobj<- estimate(hrmbgobj, X, rdsobj, k_ratio=0.2)
hrmbgobj$depParams

```
